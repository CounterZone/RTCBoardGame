"use strict";(self.webpackChunkrtc_boardgame=self.webpackChunkrtc_boardgame||[]).push([[906],{5798:function(t,e,r){r.r(e),r.d(e,{default:function(){return M}});var a=r(7294),n=r(237),o=r(1721),s=r(6187),i=r(8199);function l(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return u(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,a=new Array(e);r<e;r++)a[r]=t[r];return a}for(var c=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],h=[" "," "," "," "," "," "," "," "," "],p=[],S=0;S<9;S++)p.push(h.slice());for(var d={gridState:p,nextPlayer:"o",nextSubboard:null,subboardState:[" "," "," "," "," "," "," "," "," "],winner:null},m=function(){function t(t){void 0===t&&(t=d),this.gameState=t}var e=t.prototype;return e.copyGameState=function(){return{}},e.checkWin=function(t){for(var e=0;e<c.length;e++){var r=c[e],a=r[0],n=r[1],o=r[2];if(("o"===t[a]||"x"===t[a])&&t[a]===t[n]&&t[a]===t[o])return t[a]}return" "},e.updateSubboardStatus=function(t){var e=this.checkWin(this.gameState.gridState[t]);return e!==this.gameState.subboardState[t]&&(this.gameState.subboardState[t]=e,!0)},e.collectNextMoves=function(){var t=[];if(null===this.gameState.nextSubboard){for(var e=0;e<9;e+=1)if(" "===this.gameState.subboardState[e])for(var r=0;r<9;r+=1)" "==this.gameState.gridState[e][r]&&t.push([e,r])}else for(var a=0;a<9;a+=1)" "===this.gameState.gridState[this.gameState.nextSubboard][a]&&t.push([this.gameState.nextSubboard,a]);return t},t}(),y=function(t){function e(e,r){var a;return void 0===e&&(e=d),void 0===r&&(r=6),(a=t.call(this,e)||this).maxDepth=r,a.gameState.nextSubboardHistory=[],a.subboardLineScore=[0,0,0,0,0,0,0,0,0],a.totalScore=0,a.boardLineScore=0,a.updateScore(),a}(0,o.Z)(e,t);var r=e.prototype;return r.updateScore=function(){for(var t=0;t<9;t+=1)this.updateSubboardLineScore(t);this.updateBoardLineScore()},r.calculateLineScore=function(t){t.sort();var e={"  o":1," oo":10,"  x":-1," xx":-10}[t=t.join("")];return void 0===e?0:e},r.updateSubboardLineScore=function(t){for(var e,r=this,a=0,n=function(){var n=e.value;s=r.gameState.gridState[t].filter((function(t,e){return n.includes(e)})),a+=r.calculateLineScore(s)},o=l(c);!(e=o()).done;){var s;n()}this.totalScore-=this.subboardLineScore[t],this.subboardLineScore[t]=a,this.totalScore+=a},r.updateBoardLineScore=function(){var t=this,e=0,r=this.checkWin(this.gameState.subboardState);if(" "!==r)return this.boardLineScore="o"==r?1e4:-1e4,void(this.totalScore=50*this.boardLineScore);for(var a,n=function(){var r=a.value;s=t.gameState.subboardState.filter((function(t,e){return r.includes(e)})),e+=t.calculateLineScore(s)},o=l(c);!(a=o()).done;){var s;n()}this.totalScore-=50*this.boardLineScore,this.boardLineScore=e,this.totalScore+=50*e},r.doMove=function(t,e){this.gameState.gridState[t][e]=this.gameState.nextPlayer,this.updateSubboardStatus(t)&&this.updateBoardLineScore(),this.updateSubboardLineScore(t),this.gameState.nextPlayer="o"===this.gameState.nextPlayer?"x":"o",this.gameState.nextSubboardHistory.push(this.gameState.nextSubboard),this.gameState.nextSubboard=" "===this.gameState.subboardState[e]?e:null},r.undoMove=function(t,e){this.gameState.nextPlayer="o"===this.gameState.nextPlayer?"x":"o",this.gameState.gridState[t][e]=" ",this.updateSubboardStatus(t)&&this.updateBoardLineScore(),this.updateSubboardLineScore(t),this.gameState.nextSubboard=this.gameState.nextSubboardHistory.pop()},r.minimax=function(t,e,r,a){var n=this.collectNextMoves(),o=0,s=null;if(0===n.length||t===this.maxDepth)return{score:o="o"===a?this.totalScore:-this.totalScore,move:null};for(var i,u=l(n);!(i=u()).done;){var c=i.value;if(this.doMove(c[0],c[1]),o=this.minimax(t+1,e,r,a).score,this.undoMove(c[0],c[1]),this.gameState.nextPlayer===a?e<o&&(e=o,s=c):r>o&&(r=o,s=c),e>=r)break}return{score:this.gameState.nextPlayer===a?e:r,move:s}},r.makeNextMove=function(){return this.minimax(0,-1e5,1e5,this.gameState.nextPlayer).move},e}(m),b={stroke:"#FFFFFF",strokeWidth:"1"},f={stroke:"#EFEFEF",strokeWidth:"0.5"},x=[" "," "," "," "," "," "," "," "," "],v=[],g=0;g<9;g++)v.push(x.slice());var k={gridState:v,nextPlayer:"o",playerSymbol:"o",playerSymbolSelected:!1,nextSubboard:null,subboardState:[" "," "," "," "," "," "," "," "," "],winner:null},P=function(t){function e(e){var r;return(r=t.call(this,e)||this).state={gameState:k,remotePlayerConnected:!1,receivedResetRequest:!1,sentResetRequest:!1},r}(0,o.Z)(e,t),e.getDerivedStateFromProps=function(t,e){return{remotePlayerConnected:t.remotePlayerConnected}};var r=e.prototype;return r.onMove=function(t){"reset"===t.type&&(this.setState({receivedResetRequest:!0}),this.state.sentResetRequest&&this.reset())},r.restart=function(t){t.state.remotePlayerConnected?t.state.receivedResetRequest?(t.props.sendMove({type:"reset"}),t.reset()):(this.props.sendChat("Restart?"),this.props.sendMove({type:"reset"}),this.setState({sentResetRequest:!0})):t.reset()},r.reset=function(){for(var t=[" "," "," "," "," "," "," "," "," "],e=[],r=0;r<9;r++)e.push(t.slice());k={gridState:e,nextPlayer:"o",playerSymbol:"o",playerSymbolSelected:!1,nextSubboard:null,subboardState:[" "," "," "," "," "," "," "," "," "],winner:null},this.setState({gameState:k,receivedResetRequest:!1,sentResetRequest:!1}),this.props.gameBoardRef.current.setState({gameState:k}),this.props.log("Restarted!")},r.AIMove=function(t){var e=new y(this.state.gameState).makeNextMove();null!=e&&this.props.gameBoardRef.current.makeMove(e[0],e[1])},r.render=function(){var t=this,e="";null!==this.state.gameState.winner?e="Winner: "+this.state.gameState.winner+"!":!0===this.state.remotePlayerConnected?(e="Current Player: ",!1===this.state.gameState.playerSymbolSelected?e+="local (o)":this.state.gameState.nextPlayer==this.state.gameState.playerSymbol?e+="local ("+this.state.gameState.nextPlayer+")":e+="remote ("+this.state.gameState.nextPlayer+")"):e="Playing locally.";var r={float:"right"};return a.createElement("div",{style:{position:"relative",marginTop:"2vh"}},a.createElement(s.Z,null,a.createElement("span",null,e),a.createElement(i.Z,{style:r,size:"sm",title:"Make next move by a minimax AI with search depth = 6",variant:"outline-secondary",disabled:this.state.remotePlayerConnected,onClick:function(){return t.AIMove(t)}},"AI 1"),a.createElement(i.Z,{style:r,size:"sm",variant:"outline-primary",onClick:function(){return t.restart(t)}},"Restart")))},e}(a.Component),E=function(t){function e(e){var r;return(r=t.call(this,e)||this).paintBox=a.createRef(),r.state={width:"100",height:"100",gameState:k,remotePlayerConnected:!1},r}(0,o.Z)(e,t),e.getDerivedStateFromProps=function(t,e){return{remotePlayerConnected:t.remotePlayerConnected}};var r=e.prototype;return r.onClick=function(t,e){!0===this.state.remotePlayerConnected?this.state.gameState.nextPlayer===this.state.gameState.playerSymbol&&this.makeMove(t,e):this.makeMove(t,e)},r.checkWin=function(t){for(var e=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],r=0;r<e.length;r++){var a=e[r],n=a[0],o=a[1],s=a[2];if(("o"===t[n]||"x"===t[n])&&t[n]===t[o]&&t[n]===t[s])return t[n]}return null},r.sendMove=function(t){this.props.sendMove({type:"move",newState:t})},r.onMove=function(t){if("move"===t.type){var e=t.newState,r=this.state.gameState;r.playerSymbolSelected?e.playerSymbol=r.playerSymbol:(e.playerSymbol="x",e.playerSymbolSelected=!0),this.setState({gameState:e}),this.props.gameInfoPanelRef.current.setState({gameState:e})}},r.makeMove=function(t,e){if(null===this.state.gameState.winner){var r=this.state.gameState;r.gridState[t][e]=r.nextPlayer;var a=this.checkWin(r.gridState[t]);null!==a?(r.subboardState[t]=a,null!==(a=this.checkWin(r.subboardState))&&(r.winner=a)):r.gridState[t].includes(" ")||(r.subboardState[t]="f"),r.nextPlayer="o"===r.nextPlayer?"x":"o",r.nextSubboard=" "===r.subboardState[e]?e:null,this.state.remotePlayerConnected&&!r.playerSymbolSelected&&(r.playerSymbolSelected=!0),this.setState({gameState:r}),this.props.gameInfoPanelRef.current.setState({gameState:r}),this.state.remotePlayerConnected&&this.sendMove(r)}},r.componentDidMount=function(){var t=Math.min(this.paintBox.current.offsetWidth,this.paintBox.current.offsetHeight);this.setState({width:t,height:t})},r.render=function(){for(var t=this,e={margin:"auto",display:"block",width:this.state.width,height:this.state.height},r=[],n=function(e){s=Math.floor(e/3),i=e%3,l=null==t.state.gameState.winner&&" "===t.state.gameState.subboardState[e]&&(e===t.state.gameState.nextSubboard||null===t.state.gameState.nextSubboard),r.push(a.createElement(C,{key:e,x:5+30*s,y:5+30*i,ownedStatus:t.state.gameState.subboardState[e],status:t.state.gameState.gridState[e],isNextSubboard:l,nextPlayer:t.state.gameState.nextPlayer,onClick:function(r){return t.onClick(e,r)}}))},o=0;o<9;o++){var s,i,l;n(o)}return a.createElement("div",{ref:this.paintBox,style:{width:"100%",height:"100%"}},a.createElement("svg",{viewBox:"0 0 100 100",style:e},a.createElement("line",{x1:"35",y1:"5",x2:"35",y2:"95",style:b}),a.createElement("line",{x1:"65",y1:"5",x2:"65",y2:"95",style:b}),a.createElement("line",{x1:"5",y1:"35",x2:"95",y2:"35",style:b}),a.createElement("line",{x1:"5",y1:"65",x2:"95",y2:"65",style:b}),r))},e}(a.Component),C=function(t){function e(e){var r;return(r=t.call(this,e)||this).state={status:r.props.status},r}(0,o.Z)(e,t),e.getDerivedStateFromProps=function(t,e){return{status:t.status}};var r=e.prototype;return r.onClick=function(t){this.props.onClick(t)},r.render=function(){var t=this;if("o"==this.props.ownedStatus)return a.createElement("circle",{cx:this.props.x+15,cy:this.props.y+15,r:"14",stroke:"red",strokeWidth:"1.5",fill:"none"});if("x"==this.props.ownedStatus)return a.createElement("g",null,a.createElement("line",{x1:this.props.x+1,y1:this.props.y+1,x2:this.props.x+29,y2:this.props.y+29,stroke:"blue",strokeWidth:"1.5"}),";",a.createElement("line",{x1:this.props.x+29,y1:this.props.y+1,x2:this.props.x+1,y2:this.props.y+29,stroke:"blue",strokeWidth:"1.5"}),";");var e=[this.props.x+7,this.props.x+15,this.props.x+23],r=[this.props.y+7,this.props.y+15,this.props.y+23],n="";if(this.props.isNextSubboard){var o="o"===this.props.nextPlayer?"red":"blue";n=a.createElement("rect",{x:this.props.x+1,y:this.props.y+1,height:"28",width:"28",strokeWidth:"0.5",stroke:o,fill:"none"})}for(var s=[],i=function(n){var o=Math.floor(n/3),i=n%3;s.push(a.createElement(w,{key:n,x:e[o],y:r[i],status:t.state.status[n],onClick:function(){return t.onClick(n)},isActive:t.props.isNextSubboard}))},l=0;l<9;l++)i(l);return a.createElement("g",null,a.createElement("line",{x1:this.props.x+11,y1:this.props.y+3,x2:this.props.x+11,y2:this.props.y+27,style:f}),a.createElement("line",{x1:this.props.x+19,y1:this.props.y+3,x2:this.props.x+19,y2:this.props.y+27,style:f}),a.createElement("line",{x1:this.props.x+3,y1:this.props.y+11,x2:this.props.x+27,y2:this.props.y+11,style:f}),a.createElement("line",{x1:this.props.x+3,y1:this.props.y+19,x2:this.props.x+27,y2:this.props.y+19,style:f}),s,n)},e}(a.Component),w=function(t){function e(e){var r;return(r=t.call(this,e)||this).state={status:r.props.status},r}(0,o.Z)(e,t),e.getDerivedStateFromProps=function(t,e){return{status:t.status}};var r=e.prototype;return r.onClick=function(t){t.props.onClick()},r.render=function(){var t=this,e="";this.props.isActive&&(e=a.createElement("rect",{x:this.props.x-3,y:this.props.y-3,width:"6",height:"6",fillOpacity:"0",onClick:function(){t.onClick(t)}}));return"o"===this.state.status?e=a.createElement("circle",{cx:this.props.x,cy:this.props.y,r:3,stroke:"red",strokeWidth:"0.7",fill:"none"}):"x"===this.state.status&&(e=a.createElement("g",null,a.createElement("line",{x1:this.props.x-3,y1:this.props.y-3,x2:this.props.x+3,y2:this.props.y+3,stroke:"blue",strokeWidth:"0.7"}),";",a.createElement("line",{x1:this.props.x+3,y1:this.props.y-3,x2:this.props.x-3,y2:this.props.y+3,stroke:"blue",strokeWidth:"0.7"}),";")),a.createElement("g",null,e)},e}(a.Component),M=function(){return a.createElement("main",null,a.createElement("title",null,"Ultimate tic-tac-toe"),a.createElement(n.Z,{gameBoard:E,gameInfoPanel:P}))}}}]);
//# sourceMappingURL=component---src-pages-ultimate-tic-tac-toe-js-e24b9f889ce66e745a32.js.map